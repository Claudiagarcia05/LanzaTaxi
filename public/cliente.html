<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Cliente - LanzaTaxi</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body class="dashboard-body">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <i class="fas fa-taxi"></i>
            <span>LanzaTaxi</span>
        </div>
        <nav class="sidebar-nav">
            <a href="#" class="nav-item active" onclick="mostrarSeccion('solicitar')">
                <i class="fas fa-car"></i>
                <span>Pedir Taxi</span>
            </a>
            <a href="#" class="nav-item" onclick="mostrarSeccion('viajes')">
                <i class="fas fa-history"></i>
                <span>Mis Viajes</span>
            </a>
            <a href="#" class="nav-item" onclick="mostrarSeccion('perfil')">
                <i class="fas fa-user"></i>
                <span>Mi Perfil</span>
            </a>
            <a href="#" class="nav-item" onclick="cerrarSesion()">
                <i class="fas fa-sign-out-alt"></i>
                <span>Cerrar Sesión</span>
            </a>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="dashboard-header">
            <h1 id="headerTitle">Solicitar Taxi</h1>
            <div class="user-info">
                <i class="fas fa-user-circle"></i>
                <span id="userName"></span>
            </div>
        </div>

        <!-- Sección: Solicitar Taxi -->
        <section id="seccion-solicitar" class="seccion active">
            <div class="grid-2">
                <!-- Formulario de solicitud -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-map-marker-alt"></i> Nueva Solicitud
                    </div>
                    <form id="formSolicitud" onsubmit="solicitarTaxi(event)">
                        <div class="form-group">
                            <label>
                                <i class="fas fa-location-arrow"></i> Punto de Recogida
                            </label>
                            <div class="input-with-button">
                                <input type="text" id="origenInput" required 
                                       placeholder="Ej: Aeropuerto de Lanzarote">
                                <button type="button" class="btn-icon" onclick="usarUbicacionActual()" 
                                        title="Usar mi ubicación">
                                    <i class="fas fa-crosshairs"></i>
                                </button>
                            </div>
                            <small class="text-muted">Coordenadas: <span id="origenCoords">-</span></small>
                        </div>

                        <div class="form-group">
                            <label>
                                <i class="fas fa-map-pin"></i> Destino
                            </label>
                            <input type="text" id="destinoInput" required 
                                   placeholder="Ej: Puerto del Carmen">
                            <small class="text-muted">Coordenadas: <span id="destinoCoords">-</span></small>
                        </div>

                        <div class="form-group">
                            <label>
                                <i class="fas fa-road"></i> Tipo de Servicio
                            </label>
                            <select id="tipoTarifa" onchange="calcularPrecio()">
                                <option value="Tarifa 2">Interurbano (Tarifa 2)</option>
                                <option value="Tarifa 1">Urbano (Tarifa 1)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>
                                <i class="fas fa-plus-circle"></i> Suplementos
                            </label>
                            <div class="checkbox-group">
                                <label>
                                    <input type="checkbox" value="aeropuerto" onchange="calcularPrecio()">
                                    Aeropuerto (+€3.50)
                                </label>
                                <label>
                                    <input type="checkbox" value="puerto" onchange="calcularPrecio()">
                                    Puerto (+€2.00)
                                </label>
                                <label>
                                    <input type="checkbox" value="nocturno" onchange="calcularPrecio()">
                                    Nocturno (+€0.20/km)
                                </label>
                                <label>
                                    <input type="checkbox" value="festivo" onchange="calcularPrecio()">
                                    Festivo (+€0.30/km)
                                </label>
                            </div>
                        </div>

                        <!-- Información del viaje -->
                        <div id="infoViaje" class="info-box" style="display: none;">
                            <div class="info-row">
                                <span><i class="fas fa-road"></i> Distancia:</span>
                                <strong id="infoDistancia">-</strong>
                            </div>
                            <div class="info-row">
                                <span><i class="fas fa-clock"></i> Tiempo estimado:</span>
                                <strong id="infoTiempo">-</strong>
                            </div>
                            <div class="info-row precio-total">
                                <span><i class="fas fa-euro-sign"></i> Precio estimado:</span>
                                <strong id="infoPrecio">-</strong>
                            </div>
                        </div>

                        <button type="button" class="btn btn-secondary btn-block" onclick="calcularRuta()">
                            <i class="fas fa-calculator"></i> Calcular Precio
                        </button>

                        <button type="submit" class="btn btn-primary btn-block" id="btnSolicitar" disabled>
                            <i class="fas fa-car"></i> Solicitar Taxi
                        </button>
                    </form>
                </div>

                <!-- Mapa -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-map"></i> Mapa
                    </div>
                    <div id="map" style="height: 500px; border-radius: 10px;"></div>
                </div>
            </div>

            <!-- Estado del viaje activo -->
            <div id="viajeActivo" class="card" style="display: none; margin-top: 2rem;">
                <div class="card-header">
                    <i class="fas fa-car"></i> Tu Viaje en Curso
                </div>
                <div class="viaje-status">
                    <div class="status-indicator">
                        <div class="spinner"></div>
                        <p id="statusTexto">Buscando taxi disponible...</p>
                    </div>
                    <div id="taxistaInfo" style="display: none;">
                        <h3>Taxista Asignado</h3>
                        <p><strong>Nombre:</strong> <span id="taxistaNombre"></span></p>
                        <p><strong>Vehículo:</strong> <span id="taxistaVehiculo"></span></p>
                        <p><strong>Matrícula:</strong> <span id="taxistaMatricula"></span></p>
                        <p><strong>Licencia:</strong> <span id="taxistaLicencia"></span></p>
                        <p><i class="fas fa-star" style="color: #f39c12;"></i> <span id="taxistaValoracion"></span>/5</p>
                    </div>
                    <button class="btn btn-danger" onclick="cancelarViaje()">
                        <i class="fas fa-times"></i> Cancelar Viaje
                    </button>
                </div>
            </div>
        </section>

        <!-- Sección: Mis Viajes -->
        <section id="seccion-viajes" class="seccion">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-history"></i> Historial de Viajes
                </div>
                <div id="listaViajes">
                    <div class="spinner"></div>
                </div>
            </div>
        </section>

        <!-- Sección: Perfil -->
        <section id="seccion-perfil" class="seccion">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-user"></i> Mi Perfil
                </div>
                <div id="datosPerfil">
                    <div class="spinner"></div>
                </div>
            </div>
        </section>
    </div>

    <!-- Modal Valoración -->
    <div id="modalValoracion" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModalValoracion()">&times;</span>
            <h2>Valorar Viaje</h2>
            <form onsubmit="enviarValoracion(event)">
                <input type="hidden" id="viajeIdValoracion">
                <div class="form-group">
                    <label>Calificación</label>
                    <div class="rating">
                        <i class="fas fa-star" data-rating="1" onclick="seleccionarEstrellas(1)"></i>
                        <i class="fas fa-star" data-rating="2" onclick="seleccionarEstrellas(2)"></i>
                        <i class="fas fa-star" data-rating="3" onclick="seleccionarEstrellas(3)"></i>
                        <i class="fas fa-star" data-rating="4" onclick="seleccionarEstrellas(4)"></i>
                        <i class="fas fa-star" data-rating="5" onclick="seleccionarEstrellas(5)"></i>
                    </div>
                    <input type="hidden" id="valoracionEstrellas" value="5">
                </div>
                <div class="form-group">
                    <label>Comentario (opcional)</label>
                    <textarea id="valoracionComentario" rows="4" 
                              placeholder="Cuéntanos sobre tu experiencia..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-paper-plane"></i> Enviar Valoración
                </button>
            </form>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/cliente.js"></script>
</body>
</html>
